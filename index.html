<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registro de Canastos y Bolsos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f1f5f9;
      margin: 0;
      padding: 10px;
      color: #1f2937;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      max-width: 420px;
      margin: 0 auto;
    }
    h2 { text-align: center; }
    .form-group { display: flex; flex-direction: column; gap: 10px; }
    select, input {
      font-size: 18px;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: 100%;
    }
    .scroll-container {
      max-height: 160px;
      overflow-y: auto;
      margin-top: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th, td {
      padding: 6px;
      text-align: center;
      border-bottom: 1px solid #f1f5f9;
    }
    thead th {
      background: #e2e8f0;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .resumen-container {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 15px;
      font-weight: bold;
    }
    #nombreCadete { color: #2563eb; }
    .botones {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    button {
      padding: 10px 16px;
      font-size: 14px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      background-color: #10b981;
      color: white;
    }
    button:hover { background-color: #059669; }
    button.reiniciar {
      background-color: #ef4444;
    }
    button.reiniciar:hover {
      background-color: #b91c1c;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Registro de Canastos y Bolsos</h2>

    <div class="form-group">
      <select id="cadete">
        <option value="" disabled selected>Seleccion√° Cadete</option>
        <option value="186036">Masmuti (186036)</option>
        <option value="173994">Aguilar (173994)</option>
        <option value="174947">Cutipa (174947)</option>
        <option value="185479">Lucero (185479)</option>
        <option value="170202">Barrera (170202)</option>
        <option value="nuevo">‚ûï Agregar nuevo cadete</option>
      </select>
      <input type="text" id="pedido" placeholder="N¬∞ Pedido (solo n√∫meros)" inputmode="numeric" />
      <input type="number" id="canastos" placeholder="Canastos" min="0" />
      <input type="number" id="bolsos" placeholder="Bolsos" min="0" />
    </div>

    <div class="scroll-container">
      <table>
        <thead>
          <tr>
            <th>Pedido</th>
            <th>Canastos</th>
            <th>Bolsos</th>
          </tr>
        </thead>
        <tbody id="tablaDatos"></tbody>
      </table>
    </div>

    <div class="resumen-container">
      <div id="nombreCadete">Cadete: ‚Äî</div>
      <div id="totales">Canastos: 0 | Bolsos: 0</div>
    </div>

    <div class="botones">
      <button onclick="imprimirResumen()">üñ®Ô∏è Imprimir Resumen</button>
      <button class="reiniciar" onclick="reiniciarTabla()">‚ôªÔ∏è Reiniciar</button>
    </div>
  </div>

<script>
  const cadetes = {
    "186036": "Masmuti",
    "173994": "Aguilar",
    "174947": "Cutipa",
    "185479": "Lucero",
    "170202": "Barrera"
  };

  const cadeteSelect = document.getElementById("cadete");
  const pedidoInput = document.getElementById("pedido");
  const canastosInput = document.getElementById("canastos");
  const bolsosInput = document.getElementById("bolsos");
  const tablaBody = document.getElementById("tablaDatos");
  const nombreCadete = document.getElementById("nombreCadete");
  const totalesDiv = document.getElementById("totales");

  let registros = [];
  let legajoActual = "";
  let cadeteActual = "";

  function cargarRegistros(legajo) {
    const datos = localStorage.getItem("registros_" + legajo);
    registros = datos ? JSON.parse(datos) : [];
    renderTabla();
  }

  function guardarRegistros() {
    if (legajoActual) {
      localStorage.setItem("registros_" + legajoActual, JSON.stringify(registros));
    }
  }

  function renderTabla() {
    tablaBody.innerHTML = "";
    let totalCanastos = 0;
    let totalBolsos = 0;

    registros.forEach(reg => {
      const row = document.createElement("tr");
      row.innerHTML = `<td>${reg.pedido}</td><td>${reg.canastos}</td><td>${reg.bolsos}</td>`;
      tablaBody.appendChild(row);
      totalCanastos += reg.canastos;
      totalBolsos += reg.bolsos;
    });

    totalesDiv.textContent = `Canastos: ${totalCanastos} | Bolsos: ${totalBolsos}`;
    guardarRegistros();
  }

  function limpiarInputs() {
    pedidoInput.value = "";
    canastosInput.value = "";
    bolsosInput.value = "";
  }

  function agregarRegistro() {
    let pedido = pedidoInput.value.trim();
    const canastos = parseInt(canastosInput.value) || 0;
    const bolsos = parseInt(bolsosInput.value) || 0;

    if (!cadeteActual) {
      alert("Seleccion√° un cadete v√°lido.");
      return;
    }

    if (!pedido) {
      let numeros = registros.map(r => parseInt(r.pedido)).filter(n => !isNaN(n));
      let max = numeros.length ? Math.max(...numeros) : 0;
      pedido = (max + 1).toString();
    }

    const index = registros.findIndex(r => r.pedido === pedido);
    if (index !== -1) {
      registros[index].canastos = canastos;
      registros[index].bolsos = bolsos;
    } else {
      registros.push({ pedido, canastos, bolsos });
    }

    renderTabla();
    limpiarInputs();
    pedidoInput.focus();
  }

  function imprimirResumen() {
    if (!cadeteActual || registros.length === 0) {
      alert("Seleccion√° un cadete y carg√° al menos un pedido.");
      return;
    }

    const fecha = new Date().toLocaleString("es-AR");
    let tabla = `
      <html><head><title>Resumen</title>
      <style>
        body { font-family: Arial; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #000; padding: 8px; text-align: center; }
        .footer { margin-top: 30px; }
      </style></head><body>
      <h2>Resumen de Reparto</h2>
      <table>
        <thead><tr><th>Pedido</th><th>Canastos</th><th>Bolsos</th></tr></thead>
        <tbody>`;

    let totalC = 0, totalB = 0;
    registros.forEach(r => {
      tabla += `<tr><td>${r.pedido}</td><td>${r.canastos}</td><td>${r.bolsos}</td></tr>`;
      totalC += r.canastos;
      totalB += r.bolsos;
    });

    tabla += `</tbody><tfoot><tr><td><b>Total</b></td><td>${totalC}</td><td>${totalB}</td></tr></tfoot></table>
      <div class="footer">
        <p>Cadete: <b>${cadeteActual}</b> (${legajoActual})</p>
        <p>Fecha: ${fecha}</p>
      </div></body></html>`;

    const win = window.open("", "_blank");
    win.document.write(tabla);
    win.document.close();
    win.focus();
    win.print();
  }

  function reiniciarTabla() {
    if (confirm("¬øBorrar todos los registros del cadete actual?")) {
      registros = [];
      localStorage.removeItem("registros_" + legajoActual);
      renderTabla();
    }
  }

  cadeteSelect.addEventListener("change", () => {
    const legajo = cadeteSelect.value;
    if (legajo === "nuevo") {
      const nuevoLegajo = prompt("Legajo:");
      const nuevoNombre = prompt("Nombre:");
      if (!nuevoLegajo || !nuevoNombre) return;
      cadetes[nuevoLegajo] = nuevoNombre;
      const opt = document.createElement("option");
      opt.value = nuevoLegajo;
      opt.textContent = `${nuevoNombre} (${nuevoLegajo})`;
      cadeteSelect.insertBefore(opt, cadeteSelect.querySelector('option[value="nuevo"]'));
      cadeteSelect.value = nuevoLegajo;
    }
    cadeteActual = cadetes[cadeteSelect.value];
    legajoActual = cadeteSelect.value;
    nombreCadete.textContent = "Cadete: " + cadeteActual;
    cargarRegistros(legajoActual);
    pedidoInput.focus();
  });

  pedidoInput.addEventListener("keydown", e => {
    if (e.key === "Enter") canastosInput.focus();
  });

  canastosInput.addEventListener("keydown", e => {
    if (e.key === "Enter") bolsosInput.focus();
  });

  bolsosInput.addEventListener("keydown", e => {
    if (e.key === "Enter") agregarRegistro();
  });
</script>
</body>
</html>
